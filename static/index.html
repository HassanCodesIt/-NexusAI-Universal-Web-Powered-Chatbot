<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NexusAI - Intelligent Web Chat</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .hidden { display: none !important; }
    body {
      background: #181a20;
      min-height: 100vh;
      margin: 0;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .headline {
      font-size: 3.2rem;
      font-weight: 900;
      background: linear-gradient(90deg, #4f8cff 20%, #b388ff 60%, #ff6bcb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      margin-top: 3.5rem;
      margin-bottom: 0.2em;
      text-align: center;
      letter-spacing: -2px;
      text-shadow: 0 2px 24px #0004;
    }
    .subtitle {
      font-size: 2rem;
      color: #bdbdbd;
      font-weight: 400;
      margin-bottom: 2.5rem;
      text-align: center;
      letter-spacing: -1px;
    }
    .suggestion-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 2rem;
      justify-content: center;
      margin-bottom: 2.5rem;
      overflow-x: auto;
    }
    .suggestion-card {
      background: #23242b;
      color: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 24px #0002;
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      min-width: 200px;
      max-width: 320px;
      font-size: 1.15rem;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      position: relative;
      transition: transform 0.15s, box-shadow 0.15s;
      cursor: pointer;
      flex: 1 1 0;
    }
    .suggestion-card:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 8px 32px #0004;
      background: #292b33;
    }
    .suggestion-text {
      padding-right: 45px;
      display: block;
    }
    .suggestion-icon {
      position: absolute;
      right: 18px;
      bottom: 18px;
      background: #23242b;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: #b388ff;
      box-shadow: 0 2px 8px #0002;
    }
    .input-bar-container {
      width: 100%;
      max-width: 650px;
      margin: 0 auto 1.5rem auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .input-bar {
      display: flex;
      align-items: center;
      background: #23242b;
      border-radius: 2.5em;
      padding: 0 1.6em;
      box-shadow: 0 2px 16px #0003;
      margin-bottom: 1em;
      min-height: 60px;
      height: 60px;
      width: 100%;
      max-width: 650px;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .input-bar .input-icons {
      display: flex;
      gap: 0.5em;
      align-items: center;
      margin-right: 0.7em;
    }
    .input-bar .input-icon-btn {
      background: #23242b;
      border: none;
      color: #bdbdbd;
      font-size: 1.3rem;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #0002;
    }
    .input-bar .input-icon-btn:hover {
      background: #7c4dff;
      color: #fff;
      box-shadow: 0 4px 16px #7c4dff44;
    }
    .input-bar input {
      flex: 1;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.13rem;
      padding: 0.8em 0.5em;
      outline: none;
      height: 100%;
    }
    .input-bar button[type="submit"] {
      background: none;
      border: none;
      color: #b388ff;
      font-size: 1.7rem;
      margin-left: 0.7em;
      cursor: pointer;
      transition: color 0.2s;
      height: 44px;
      width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    .input-bar button[type="submit"]:hover {
      color: #fff;
      background: #7c4dff33;
    }
    .footer-bar {
      position: fixed;
      left: 0; right: 0;
      bottom: 3.5em;
      margin: 0 auto;
      z-index: 20;
      display: flex;
      gap: 1.2em;
      justify-content: center;
      align-items: center;
      background: rgba(35,36,43,0.82);
      box-shadow: 0 4px 24px #0004;
      backdrop-filter: blur(8px) saturate(1.2);
      border-radius: 2em;
      padding: 0.5em 1.5em;
      width: fit-content;
      min-width: 180px;
      max-width: 90vw;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .footer-bar button {
      background: #23242b;
      border: none;
      color: #bdbdbd;
      font-size: 1.3rem;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #0002;
      margin-right: 0.2em;
    }
    .footer-bar button:hover {
      background: #7c4dff;
      color: #fff;
      box-shadow: 0 4px 16px #7c4dff44;
    }
    @media (max-width: 900px) {
      .footer-bar {
        left: 2vw; right: 2vw;
        padding: 0.5em 0.5em;
        min-width: 0;
      }
      .footer-bar button {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
      }
    }
    .input-bar-container {
      margin-bottom: 5.5em !important;
    }
    .disclaimer {
      color: #fff;
      font-size: 1rem;
      background: rgba(30,32,40,0.92);
      position: fixed;
      right: 2.2em;
      bottom: 2.2em;
      min-width: 320px;
      max-width: 90vw;
      padding: 1em 1.5em;
      border-radius: 1em;
      box-shadow: 0 4px 24px #0006;
      z-index: 9999;
      opacity: 0.85;
      transition: opacity 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      gap: 0.7em;
      pointer-events: auto;
    }
    .disclaimer:hover {
      opacity: 1;
      box-shadow: 0 8px 32px #000a;
    }
    .disclaimer .close-disclaimer {
      margin-left: 1em;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.1em;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .disclaimer .close-disclaimer:hover {
      opacity: 1;
    }
    .footer-bar .info-btn {
      background: #23242b;
      border: none;
      color: #bdbdbd;
      font-size: 1.3rem;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #0002;
      margin-right: 0.2em;
    }
    .footer-bar .info-btn:hover {
      background: #7c4dff;
      color: #fff;
      box-shadow: 0 4px 16px #7c4dff44;
    }
    body.light-mode .disclaimer {
      color: #23242b;
      background: #fff;
    }
    #chat-messages {
      width:100%;
      max-width:700px;
      margin:0 auto;
      min-height: 120px;
      margin-bottom: 3.5em;
    }
    .message {
      margin: 1em 0;
      padding: 1em 1.5em;
      border-radius: 1.2em;
      background: #23242b;
      color: #fff;
      font-size: 1.1em;
      box-shadow: 0 2px 12px #0002;
      word-break: break-word;
      animation: fadeIn 0.3s;
    }
    .message.user {
      background: #7c4dff;
      color: #fff;
      text-align: right;
    }
    .message.bot {
      background: #23242b;
      color: #fff;
      text-align: left;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: none; }
    }
    @media (max-width: 900px) {
      .suggestion-row {
        flex-direction: column;
        flex-wrap: wrap;
        gap: 1.2rem;
        overflow-x: unset;
      }
      .suggestion-card {
        min-width: 90vw;
        max-width: 98vw;
      }
      .input-bar-container, #chat-messages {
        max-width: 98vw;
      }
    }
    /* Settings Modal */
    .modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-bg.active { display: flex; }
    .modal {
      background: #23242b;
      color: #fff;
      border-radius: 18px;
      padding: 2.2em 2.5em 2em 2.5em;
      min-width: 320px;
      box-shadow: 0 8px 32px #0008;
      position: relative;
      text-align: center;
    }
    .modal h2 {
      margin-top: 0;
      font-size: 1.5em;
      margin-bottom: 1em;
    }
    .modal .close-btn {
      position: absolute;
      top: 1em;
      right: 1em;
      background: none;
      border: none;
      color: #bdbdbd;
      font-size: 1.3em;
      cursor: pointer;
      transition: color 0.2s;
    }
    .modal .close-btn:hover { color: #fff; }
    .modal .setting-group {
      margin-bottom: 1.3em;
      text-align: left;
    }
    .modal label {
      font-size: 1.08em;
      color: #bdbdbd;
      margin-right: 0.7em;
    }
    .modal select, .modal input[type="radio"] {
      margin-right: 0.5em;
    }
    .modal .radio-row {
      display: flex;
      gap: 1.2em;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    .modal .save-btn {
      margin-top: 1.2em;
      background: #7c4dff;
      color: #fff;
      border: none;
      border-radius: 1em;
      padding: 0.6em 1.5em;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .modal .save-btn:hover {
      background: #4f8cff;
    }
    body.light-mode {
      background: #f5f6fa;
      color: #23242b;
    }
    body.light-mode .headline {
      text-shadow: 0 2px 24px #fff4;
    }
    body.light-mode .subtitle,
    body.light-mode .disclaimer {
      color: #444;
    }
    body.light-mode .suggestion-card,
    body.light-mode .input-bar,
    body.light-mode .footer-bar button,
    body.light-mode .modal {
      background: #fff;
      color: #23242b;
      box-shadow: 0 4px 24px #0001;
    }
    body.light-mode .suggestion-card:hover,
    body.light-mode .footer-bar button:hover {
      background: #e6e6fa;
      color: #7c4dff;
    }
    body.light-mode .input-bar input {
      color: #23242b;
    }
    body.light-mode .modal .close-btn {
      color: #888;
    }
    body.light-mode .modal .close-btn:hover {
      color: #23242b;
    }
    body.font-small { font-size: 14px; }
    body.font-medium { font-size: 17px; }
    body.font-large { font-size: 20px; }
    .message.classic { border-radius: 1.2em; }
    .message.minimal { border-radius: 0.4em; }
    /* Thinking Indicator */
    #thinking-indicator {
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      margin: 2em 0 1.5em 0;
      width: 100%;
      animation: fadeIn 0.4s;
    }
    .ai-orb {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: radial-gradient(circle at 60% 40%, #b388ff 0%, #4f8cff 60%, #23242b 100%);
      box-shadow: 0 0 24px 8px #7c4dff88, 0 0 0 0 #fff0;
      animation: orbPulse 1.4s infinite alternate, orbSpin 2.5s linear infinite;
      margin-bottom: 0.7em;
      position: relative;
    }
    .ai-orb::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(255,255,255,0.18);
      filter: blur(1.5px);
    }
    @keyframes orbPulse {
      0% { box-shadow: 0 0 24px 8px #7c4dff88, 0 0 0 0 #fff0; }
      100% { box-shadow: 0 0 36px 16px #b388ffcc, 0 0 0 0 #fff0; }
    }
    @keyframes orbSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .thinking-msg {
      color: #b388ff;
      font-size: 1.13em;
      font-weight: 500;
      letter-spacing: 0.01em;
      text-align: center;
      text-shadow: 0 2px 12px #0004;
      margin-top: 0.1em;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      animation: fadeIn 0.7s;
    }
    /* Animated background gradient */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 0;
      background: linear-gradient(120deg, #23242b 0%, #4f8cff 50%, #b388ff 100%);
      opacity: 0.18;
      animation: bgMove 16s ease-in-out infinite alternate;
      pointer-events: none;
    }
    @keyframes bgMove {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    /* Glassmorphism card */
    .message.bot, .message.user {
      background: rgba(35,36,43,0.82);
      box-shadow: 0 8px 32px 0 #0004;
      backdrop-filter: blur(8px) saturate(1.2);
      border: 1.5px solid rgba(127, 127, 255, 0.13);
      margin-bottom: 1.2em;
      transition: box-shadow 0.2s, background 0.2s;
    }
    .message.user {
      background: linear-gradient(90deg, #7c4dff 60%, #4f8cff 100%);
      color: #fff;
      align-self: flex-end;
      border-radius: 1.2em 1.2em 0.2em 1.2em;
      box-shadow: 0 4px 24px #7c4dff44;
      margin-left: 20%;
    }
    .message.bot {
      background: rgba(35,36,43,0.82);
      color: #fff;
      align-self: flex-start;
      border-radius: 1.2em 1.2em 1.2em 0.2em;
      margin-right: 20%;
    }
    #chat-messages {
      display: flex;
      flex-direction: column;
      gap: 0.2em;
      position: relative;
      z-index: 1;
    }
    .message {
      animation: popIn 0.35s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes popIn {
      0% { transform: scale(0.95) translateY(20px); opacity: 0; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }
    /* Animated headline gradient */
    .headline span {
      background: linear-gradient(90deg, #4f8cff 20%, #b388ff 60%, #ff6bcb 100%);
      background-size: 200% 200%;
      animation: gradientMove 4s ease-in-out infinite alternate;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    /* Input bar glow */
    .input-bar {
      box-shadow: 0 2px 12px #0002, 0 0 0 0 #7c4dff;
      transition: box-shadow 0.2s;
    }
    .input-bar:focus-within {
      box-shadow: 0 2px 12px #7c4dff44, 0 0 0 3px #7c4dff55;
    }
    .input-bar button {
      transition: color 0.2s, transform 0.1s;
    }
    .input-bar button:active {
      transform: scale(0.92);
    }
    /* Suggestion card animation */
    .suggestion-card {
      transition: transform 0.18s, box-shadow 0.18s, background 0.18s;
      overflow: hidden;
      position: relative;
    }
    .suggestion-card:hover {
      transform: translateY(-8px) scale(1.04) rotate(-1deg);
      box-shadow: 0 12px 36px #7c4dff33;
      background: linear-gradient(90deg, #23242b 80%, #4f8cff22 100%);
    }
    .suggestion-icon {
      animation: iconPulse 1.5s infinite alternate;
    }
    @keyframes iconPulse {
      0% { color: #b388ff; transform: scale(1); }
      100% { color: #ff6bcb; transform: scale(1.18); }
    }
    /* Responsive max width */
    .headline, .subtitle, #chat-messages, .input-bar-container, .suggestion-row {
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    /* Subtle particle effect */
    #nexus-particles {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 0;
    }
    .nexus-particle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.13;
      background: linear-gradient(120deg, #b388ff, #4f8cff);
      filter: blur(2px);
      animation: floatParticle 12s linear infinite;
    }
    @keyframes floatParticle {
      0% { transform: translateY(0) scale(1); opacity: 0.13; }
      50% { opacity: 0.22; }
      100% { transform: translateY(-60vh) scale(1.2); opacity: 0.13; }
    }
    /* Classic UI overrides */
    body.classic-ui .message.bot, body.classic-ui .message.user {
      background: #23242b !important;
      box-shadow: none !important;
      border: none !important;
      backdrop-filter: none !important;
    }
    body.classic-ui .message.user {
      background: #7c4dff !important;
      color: #fff !important;
      border-radius: 1.2em !important;
      margin-left: 0 !important;
      box-shadow: none !important;
    }
    body.classic-ui .message.bot {
      background: #23242b !important;
      color: #fff !important;
      border-radius: 1.2em !important;
      margin-right: 0 !important;
    }
    body.classic-ui .headline span {
      background: none !important;
      color: #7c4dff !important;
      -webkit-text-fill-color: unset !important;
      text-fill-color: unset !important;
      animation: none !important;
    }
    body.classic-ui .input-bar {
      box-shadow: 0 2px 12px #0002 !important;
    }
    body.classic-ui .input-bar:focus-within {
      box-shadow: 0 2px 12px #7c4dff44 !important;
    }
    body.classic-ui .suggestion-card {
      background: #23242b !important;
      box-shadow: 0 4px 24px #0002 !important;
      transform: none !important;
      border-radius: 20px !important;
      animation: none !important;
    }
    body.classic-ui .suggestion-card:hover {
      background: #292b33 !important;
      box-shadow: 0 8px 32px #0004 !important;
      transform: none !important;
    }
    body.classic-ui .suggestion-icon {
      animation: none !important;
      color: #b388ff !important;
    }
    body.classic-ui #nexus-particles, body.classic-ui::before {
      display: none !important;
    }
    body.classic-ui #chat-messages {
      background: none !important;
    }
    /* Custom UI Style Dropdown */
    .ui-style-dropdown {
      position: relative;
      display: inline-block;
      min-width: 120px;
      font-size: 1.08em;
      z-index: 10;
    }
    .ui-style-selected {
      background: linear-gradient(90deg, #4f8cff 20%, #b388ff 100%);
      color: #fff;
      border: none;
      border-radius: 0.7em;
      padding: 0.45em 1.2em 0.45em 1.8em;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 8px #7c4dff22;
      transition: background 0.18s, color 0.18s;
      position: relative;
      outline: none;
    }
    .ui-style-selected .ui-style-icon {
      position: absolute;
      left: 0.7em;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.1em;
      opacity: 0.85;
    }
    .ui-style-dropdown.open .ui-style-selected {
      background: linear-gradient(90deg, #b388ff 20%, #4f8cff 100%);
    }
    .ui-style-options {
      display: none;
      position: absolute;
      left: 0; right: 0;
      top: 110%;
      background: #23242b;
      border-radius: 0.7em;
      box-shadow: 0 8px 32px #0008;
      padding: 0.3em 0;
      margin-top: 0.2em;
      animation: fadeIn 0.18s;
    }
    .ui-style-dropdown.open .ui-style-options {
      display: block;
    }
    .ui-style-option {
      display: flex;
      align-items: center;
      gap: 0.7em;
      padding: 0.5em 1.2em 0.5em 1.8em;
      color: #fff;
      cursor: pointer;
      font-weight: 500;
      border: none;
      background: none;
      width: 100%;
      font-size: 1em;
      transition: background 0.15s, color 0.15s;
    }
    .ui-style-option.selected, .ui-style-option:hover {
      background: linear-gradient(90deg, #4f8cff 20%, #b388ff 100%);
      color: #fff;
    }
    .ui-style-option .ui-style-icon {
      font-size: 1.1em;
      opacity: 0.85;
    }
    body.light-mode .ui-style-options {
      background: #fff;
      color: #23242b;
      box-shadow: 0 8px 32px #b388ff22;
    }
    body.light-mode .ui-style-option {
      color: #23242b;
    }
    body.light-mode .ui-style-option.selected, body.light-mode .ui-style-option:hover {
      background: linear-gradient(90deg, #b388ff 20%, #4f8cff 100%);
      color: #fff;
    }
    body.light-mode .suggestion-card {
      background: #f5f6fa !important;
      color: #23242b !important;
      box-shadow: 0 4px 24px #b388ff11 !important;
    }
    body.light-mode .suggestion-card:hover {
      background: #e6e6fa !important;
      color: #7c4dff !important;
      box-shadow: 0 8px 32px #b388ff33 !important;
    }
    body.light-mode .suggestion-icon {
      color: #7c4dff !important;
      animation: iconPulse 1.5s infinite alternate;
    }
    /* Floating suggestion row */
    .suggestion-row-floating {
      position: absolute;
      left: 0; right: 0;
      top: 0;
      margin: 0 auto;
      z-index: 10;
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      pointer-events: auto;
      max-width: 700px;
      width: 100%;
      padding-top: 2.5rem;
      transition: opacity 0.2s, transform 0.2s;
    }
    @media (max-width: 900px) {
      .suggestion-row-floating {
        flex-direction: column;
        gap: 1.2rem;
        max-width: 98vw;
        left: 1vw; right: 1vw;
      }
    }
    .suggestion-row-placeholder {
      height: 180px;
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      pointer-events: none;
    }
    /* Floating left sidebar */
    .sidebar-controls {
      position: fixed;
      top: 50%;
      left: 2.2em;
      transform: translateY(-50%);
      z-index: 30;
      display: flex;
      flex-direction: column;
      gap: 1.1em;
      background: rgba(35,36,43,0.82);
      box-shadow: 0 4px 24px #0004;
      backdrop-filter: blur(8px) saturate(1.2);
      border-radius: 1.5em;
      padding: 1.1em 0.7em;
      align-items: center;
      width: 60px;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .sidebar-controls button {
      background: #23242b;
      border: none;
      color: #bdbdbd;
      font-size: 1.3rem;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #0002;
    }
    .sidebar-controls button:hover {
      background: #7c4dff;
      color: #fff;
      box-shadow: 0 4px 16px #7c4dff44;
    }
    @media (max-width: 900px) {
      .sidebar-controls {
        top: unset;
        bottom: 2vw;
        left: 1vw;
        transform: none;
        flex-direction: row;
        width: auto;
        padding: 0.5em 0.5em;
        border-radius: 2em;
        gap: 0.7em;
      }
      .sidebar-controls button {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
      }
    }
    /* How It Works Modal */
    .howitworks-modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(24,26,32,0.92);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s;
    }
    .howitworks-modal-bg.active { display: flex; }
    .howitworks-modal {
      background: rgba(35,36,43,0.96);
      color: #fff;
      border-radius: 2em;
      padding: 2.5em 2.5em 2em 2.5em;
      min-width: 340px;
      max-width: 700px;
      width: 98vw;
      box-shadow: 0 8px 48px #000a;
      position: relative;
      text-align: left;
      overflow-y: auto;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      scrollbar-width: thin;
      scrollbar-color: #7c4dff #23242b;
    }
    .howitworks-modal::-webkit-scrollbar {
      width: 10px;
      background: transparent;
    }
    .howitworks-modal::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #4f8cff 10%, #b388ff 90%);
      border-radius: 8px;
      min-height: 40px;
      opacity: 0.7;
      box-shadow: 0 0 8px #7c4dff44;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .howitworks-modal::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #b388ff 10%, #4f8cff 90%);
      box-shadow: 0 0 16px #b388ff88;
      opacity: 1;
    }
    .howitworks-modal::-webkit-scrollbar-track {
      background: transparent;
    }
    .howitworks-modal .close-btn {
      position: absolute;
      top: 1.2em;
      right: 1.2em;
      background: none;
      border: none;
      color: #bdbdbd;
      font-size: 1.5em;
      cursor: pointer;
      transition: color 0.2s;
      z-index: 2;
    }
    .howitworks-modal .close-btn:hover { color: #fff; }
    .howitworks-title {
      font-size: 2.1em;
      font-weight: 800;
      background: linear-gradient(90deg, #4f8cff 20%, #b388ff 60%, #ff6bcb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      margin-bottom: 0.7em;
      text-align: center;
    }
    .howitworks-steps {
      display: flex;
      flex-direction: column;
      gap: 2.2em;
      width: 100%;
      margin-top: 1.2em;
    }
    .howitworks-step {
      display: flex;
      align-items: flex-start;
      gap: 1.3em;
      background: rgba(60,62,80,0.22);
      border-radius: 1.2em;
      padding: 1.2em 1.2em 1.2em 1.2em;
      box-shadow: 0 2px 12px #4f8cff11;
      position: relative;
      min-height: 80px;
    }
    .howitworks-step-icon {
      min-width: 54px;
      min-height: 54px;
      max-width: 54px;
      max-height: 54px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4f8cff 40%, #b388ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.1em;
      color: #fff;
      box-shadow: 0 2px 12px #7c4dff33;
      margin-right: 0.2em;
      animation: popIn 0.5s;
    }
    .howitworks-step-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.3em;
    }
    .howitworks-step-title {
      font-size: 1.18em;
      font-weight: 700;
      color: #b388ff;
      margin-bottom: 0.1em;
    }
    .howitworks-step-desc {
      font-size: 1.05em;
      color: #e0e0e0;
      line-height: 1.5;
    }
    .howitworks-arrow {
      text-align: center;
      font-size: 2.2em;
      color: #4f8cff;
      margin: -1.1em 0 -1.1em 0;
      opacity: 0.5;
      user-select: none;
    }
    @media (max-width: 700px) {
      .howitworks-modal { padding: 1.2em 0.2em 1.2em 0.2em; }
      .howitworks-step { flex-direction: column; align-items: center; text-align: center; }
      .howitworks-step-icon { margin-bottom: 0.5em; }
    }
    /* Hide scrollbars for sidebar and welcome */
    body, html {
      overflow-x: hidden;
    }
    .sidebar-controls {
      overflow: visible !important;
    }
    /* Only show scrollbar in modal if needed */
    .howitworks-modal {
      overflow-y: auto;
      max-height: 90vh;
    }
    .howitworks-modal-bg {
      overflow: hidden !important;
    }
    /* Documentation Modal */
    .modal-bg" id="documentation-modal-bg">
      <div class="modal">
        <button class="close-btn" id="close-documentation" title="Close">&times;</button>
        <h2>ðŸ“– NexusAI Documentation</h2>
        <div style="text-align:left; max-height:60vh; overflow-y:auto; font-size:1.08em;">
          <h3>What is NexusAI?</h3>
          <p><b>NexusAI</b> is a Retrieval-Augmented Generation (RAG) chatbot that combines real-time web retrieval with the power of large language models (LLMs) to answer your questions with up-to-date, trusted information.</p>
          <h3>How It Works (RAG Workflow)</h3>
          <ol>
            <li><b>Retrieval:</b> Finds and scrapes relevant web pages (static and dynamic) for your query.</li>
            <li><b>Augmentation:</b> Passes the retrieved content to an LLM as context.</li>
            <li><b>Generation:</b> The LLM synthesizes a clear, well-structured answer, citing sources.</li>
          </ol>
          <h3>Web Scraping Roles</h3>
          <ul>
            <li><b>requests:</b> Fetches static HTML content from web pages.</li>
            <li><b>BeautifulSoup:</b> Parses HTML and extracts relevant text/data.</li>
            <li><b>Selenium:</b> Automates a browser for dynamic/JS-heavy sites.</li>
            <li><b>webdriver-manager:</b> Installs and manages browser drivers for Selenium.</li>
          </ul>
          <h3>API Key Management</h3>
          <ul>
            <li>API keys are stored in a <code>.env</code> file and rotated automatically if a limit is hit.</li>
            <li>Never expose API keys in frontend code or public repos.</li>
          </ul>
          <h3>Cache Logic</h3>
          <ul>
            <li>Frequently asked questions and their answers are cached using ChromaDB for instant retrieval.</li>
            <li>For queries about current/trending topics (e.g., "latest news"), the cache is bypassed for fresh results.</li>
          </ul>
          <h3>Security Best Practices</h3>
          <ul>
            <li>Use HTTPS in production to encrypt all traffic.</li>
            <li>Sanitize user input and scraped content to prevent XSS.</li>
            <li>Add rate limiting and CORS restrictions for public deployments.</li>
            <li>Keep dependencies up to date and monitor for vulnerabilities.</li>
          </ul>
          <h3>Contact & Contribution</h3>
          <ul>
            <li><b>GitHub:</b> <a href="https://github.com/HassanCodesIt" target="_blank">HassanCodesIt</a></li>
            <li><b>Project Repository:</b> <a href="https://github.com/HassanCodesIt/-NexusAI-Universal-Web-Powered-Chatbot" target="_blank">NexusAI Universal Web-Powered Chatbot</a></li>
            <li><b>Email:</b> <a href="mailto:hassanhudapalakkad@gmail.com">hassanhudapalakkad@gmail.com</a></li>
          </ul>
        </div>
      </div>
    </div>
  </style>
</head>
<body>
  <div class="headline" id="headline">Welcome to <span style="background: linear-gradient(90deg, #4f8cff 20%, #b388ff 60%, #ff6bcb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent;">NexusAI</span></div>
  <div class="subtitle" id="subtitle">Your intelligent link to the world of information. Ask me anything!</div>
  <div style="position:relative; width:100%; max-width:700px; margin:0 auto;">
    <div class="suggestion-row-floating" id="suggestion-row"></div>
    <div class="suggestion-row-placeholder" id="suggestion-row-placeholder"></div>
  </div>
  <div id="chat-messages"></div>
  <div class="sidebar-controls">
    <button type="button" class="info-btn" id="show-disclaimer-btn" title="Show disclaimer" style="display:none;"><i class="fas fa-info-circle"></i></button>
    <button type="button" title="How it works" id="howitworks-btn"><i class="fas fa-book-open"></i></button>
    <button type="button" title="Settings" id="settings-btn"><i class="fas fa-cog"></i></button>
    <button type="button" title="Clear" id="clear-btn"><i class="fas fa-trash"></i></button>
  </div>
  <form class="input-bar-container" id="chat-form" autocomplete="off" onsubmit="return sendMessage(event)">
    <div class="input-bar">
      <input type="text" id="user-input" placeholder="Ask me anything..." required />
      <button type="submit" title="Send"><i class="fas fa-paper-plane"></i></button>
    </div>
  </form>
  <!-- Settings Modal -->
  <div class="modal-bg" id="settings-modal-bg">
    <div class="modal">
      <button class="close-btn" id="close-settings" title="Close">&times;</button>
      <h2>Settings</h2>
      <div class="setting-group">
        <label for="theme-toggle"><i class="fas fa-adjust"></i> Light Mode</label>
        <input type="checkbox" id="theme-toggle" />
      </div>
      <div class="setting-group">
        <label for="font-size-select"><i class="fas fa-text-height"></i> Font Size</label>
        <select id="font-size-select">
          <option value="font-small">Small</option>
          <option value="font-medium">Medium</option>
          <option value="font-large">Large</option>
        </select>
      </div>
      <div class="setting-group">
        <label><i class="fas fa-comment-dots"></i> Chat Bubble Style</label>
        <div class="radio-row">
          <label><input type="radio" name="bubble-style" value="classic" checked /> Classic</label>
          <label><input type="radio" name="bubble-style" value="minimal" /> Minimal</label>
        </div>
      </div>
      <div class="setting-group">
        <label><i class="fas fa-user-astronaut"></i> AI Personality</label>
        <div class="radio-row">
          <label><input type="radio" name="ai-personality" value="balanced" checked /> Balanced</label>
          <label><input type="radio" name="ai-personality" value="creative" /> Creative</label>
          <label><input type="radio" name="ai-personality" value="factual" /> Factual</label>
        </div>
      </div>
      <div class="setting-group">
        <label><i class="fas fa-paint-brush"></i> UI Style</label>
        <div class="ui-style-dropdown" id="ui-style-dropdown">
          <button type="button" class="ui-style-selected" id="ui-style-selected">
            <span class="ui-style-icon" id="ui-style-selected-icon"><i class="fas fa-square"></i></span>
            <span id="ui-style-selected-label">Classic</span>
            <span style="position:absolute;right:0.7em;top:50%;transform:translateY(-50%);font-size:0.9em;opacity:0.7;">â–¼</span>
          </button>
          <div class="ui-style-options" id="ui-style-options">
            <div class="ui-style-option" data-value="classic-ui">
              <span class="ui-style-icon"><i class="fas fa-square"></i></span> Classic
            </div>
            <div class="ui-style-option" data-value="modern-ui">
              <span class="ui-style-icon"><i class="fas fa-gem"></i></span> Modern
            </div>
          </div>
        </div>
      </div>
      <button class="save-btn" id="save-settings">Save Settings</button>
      <div style="margin-top:1.5em; color:#bdbdbd; font-size:0.98em;">
        <i class="fas fa-wand-magic-sparkles"></i> More settings coming soon!
      </div>
    </div>
  </div>
  <div class="disclaimer" id="disclaimer-toast" style="display:none;">
    <span><i class="fas fa-exclamation-triangle"></i> NexusAI may display inaccurate info, including about people, so double-check its responses.</span>
    <button class="close-disclaimer" id="close-disclaimer-btn" title="Dismiss">&times;</button>
  </div>
  <div id="nexus-particles"></div>
  <!-- How It Works Modal -->
  <div class="howitworks-modal-bg" id="howitworks-modal-bg">
    <div class="howitworks-modal">
      <button class="close-btn" id="close-howitworks" title="Close">&times;</button>
      <div class="howitworks-title">How NexusAI Works</div>
      <div class="howitworks-steps">
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-user"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">1. User Prompt</div>
            <div class="howitworks-step-desc">You enter a question or request in the chat bar. NexusAI is ready for anythingâ€”science, history, football, and more!</div>
          </div>
        </div>
        <div class="howitworks-arrow"><i class="fas fa-arrow-down"></i></div>
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-search"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">2. Trusted Source Search</div>
            <div class="howitworks-step-desc">NexusAI searches the web, giving preference to a curated list of trusted sources for your topic.</div>
          </div>
        </div>
        <div class="howitworks-arrow"><i class="fas fa-spider"></i></div>
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-globe"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">3. Web Scraping</div>
            <div class="howitworks-step-desc">Relevant web pages are scraped for up-to-date information, using both static and dynamic techniques.</div>
          </div>
        </div>
        <div class="howitworks-arrow"><i class="fas fa-brain"></i></div>
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-robot"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">4. LLM Synthesis</div>
            <div class="howitworks-step-desc">A powerful AI model (LLM) reads the scraped content and crafts a clear, well-structured answer just for you.</div>
          </div>
        </div>
        <div class="howitworks-arrow"><i class="fas fa-database"></i></div>
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-bolt"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">5. Vector Cache</div>
            <div class="howitworks-step-desc">If a similar question was answered before, NexusAI instantly retrieves the cached answer for lightning-fast results.</div>
          </div>
        </div>
        <div class="howitworks-arrow"><i class="fas fa-comment-dots"></i></div>
        <div class="howitworks-step">
          <div class="howitworks-step-icon"><i class="fas fa-comments"></i></div>
          <div class="howitworks-step-content">
            <div class="howitworks-step-title">6. Response Display</div>
            <div class="howitworks-step-desc">You see a beautiful, cited answer in the chatâ€”complete with sources and a modern UI. Ready for your next question!</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Documentation Modal -->
  <div class="modal-bg" id="documentation-modal-bg">
    <div class="modal">
      <button class="close-btn" id="close-documentation" title="Close">&times;</button>
      <h2>ðŸ“– NexusAI Documentation</h2>
      <div style="text-align:left; max-height:60vh; overflow-y:auto; font-size:1.08em;">
        <h3>What is NexusAI?</h3>
        <p><b>NexusAI</b> is a Retrieval-Augmented Generation (RAG) chatbot that combines real-time web retrieval with the power of large language models (LLMs) to answer your questions with up-to-date, trusted information.</p>
        <h3>How It Works (RAG Workflow)</h3>
        <ol>
          <li><b>Retrieval:</b> Finds and scrapes relevant web pages (static and dynamic) for your query.</li>
          <li><b>Augmentation:</b> Passes the retrieved content to an LLM as context.</li>
          <li><b>Generation:</b> The LLM synthesizes a clear, well-structured answer, citing sources.</li>
        </ol>
        <h3>Web Scraping Roles</h3>
        <ul>
          <li><b>requests:</b> Fetches static HTML content from web pages.</li>
          <li><b>BeautifulSoup:</b> Parses HTML and extracts relevant text/data.</li>
          <li><b>Selenium:</b> Automates a browser for dynamic/JS-heavy sites.</li>
          <li><b>webdriver-manager:</b> Installs and manages browser drivers for Selenium.</li>
        </ul>
        <h3>API Key Management</h3>
        <ul>
          <li>API keys are stored in a <code>.env</code> file and rotated automatically if a limit is hit.</li>
          <li>Never expose API keys in frontend code or public repos.</li>
        </ul>
        <h3>Cache Logic</h3>
        <ul>
          <li>Frequently asked questions and their answers are cached using ChromaDB for instant retrieval.</li>
          <li>For queries about current/trending topics (e.g., "latest news"), the cache is bypassed for fresh results.</li>
        </ul>
        <h3>Security Best Practices</h3>
        <ul>
          <li>Use HTTPS in production to encrypt all traffic.</li>
          <li>Sanitize user input and scraped content to prevent XSS.</li>
          <li>Add rate limiting and CORS restrictions for public deployments.</li>
          <li>Keep dependencies up to date and monitor for vulnerabilities.</li>
        </ul>
        <h3>Contact & Contribution</h3>
        <ul>
          <li><b>GitHub:</b> <a href="https://github.com/HassanCodesIt" target="_blank">HassanCodesIt</a></li>
          <li><b>Project Repository:</b> <a href="https://github.com/HassanCodesIt/-NexusAI-Universal-Web-Powered-Chatbot" target="_blank">NexusAI Universal Web-Powered Chatbot</a></li>
          <li><b>Email:</b> <a href="mailto:hassanhudapalakkad@gmail.com">hassanhudapalakkad@gmail.com</a></li>
        </ul>
      </div>
    </div>
  </div>
  <script>
    let firstPromptSent = false;
    let thinkingInterval = null;
    let thinkingMsgIndex = 0;
    
    // Local pool of suggestions
    const allSuggestions = [
      { text: 'Explain photosynthesis', icon: 'fa-leaf' },
      { text: 'History of AI', icon: 'fa-robot' },
      { text: 'Describe aurora', icon: 'fa-cloud' },
      { text: 'Solar system facts', icon: 'fa-sun' },
      { text: 'What is quantum computing?', icon: 'fa-microchip' },
      { text: 'Write a haiku about rain', icon: 'fa-pen-nib' },
      { text: 'Who was Ada Lovelace?', icon: 'fa-female' },
      { text: 'Explain relativity', icon: 'fa-brain' },
      { text: 'What is the Fermi Paradox?', icon: 'fa-question-circle' },
      { text: 'Summarize Hamlet', icon: 'fa-theater-masks' },
      { text: 'How does blockchain work?', icon: 'fa-link' },
      { text: 'Causes of climate change', icon: 'fa-temperature-high' },
      { text: 'Classic chocolate chip cookie recipe', icon: 'fa-cookie-bite' },
      { text: 'Who was Leonardo da Vinci?', icon: 'fa-paint-brush' },
      { text: 'Principles of supply and demand', icon: 'fa-chart-pie' },
      { text: 'What is Stoicism?', icon: 'fa-monument' },
      { text: 'Describe DNA structure', icon: 'fa-dna' },
      { text: 'Explain black holes', icon: 'fa-rocket' },
      { text: 'History of Impressionism', icon: 'fa-palette' },
      { text: 'How robots learn', icon: 'fa-robot' },
      { text: 'Design a space station', icon: 'fa-space-shuttle' },
      { text: 'What is CRISPR?', icon: 'fa-dna' },
      { text: 'What is the Silk Road?', icon: 'fa-road' },
      { text: 'What is dark matter?', icon: 'fa-moon' },
      { text: 'Benefits of meditation', icon: 'fa-dna' },
      { text: 'What is a black swan event?', icon: 'fa-swan' },
      { text: 'How do vaccines work?', icon: 'fa-syringe' },
      { text: 'What is the Turing Test?', icon: 'fa-vial' },
      { text: 'What is the Internet of Things?', icon: 'fa-network-wired' },
      { text: 'What is a neural network?', icon: 'fa-project-diagram' },
      { text: 'What is the Big Bang?', icon: 'fa-bomb' },
      { text: 'What is quantum entanglement?', icon: 'fa-atom' },
      { text: 'What is the speed of light?', icon: 'fa-bolt' },
      { text: 'What is a gene?', icon: 'fa-dna' },
      { text: 'What is a meme?', icon: 'fa-grin-beam' },
      { text: 'What is the cloud?', icon: 'fa-cloud' },
      { text: 'What is a blockchain?', icon: 'fa-link' },
      { text: 'What is a supernova?', icon: 'fa-star' },
      { text: 'What is a fractal?', icon: 'fa-shapes' },
      { text: 'What is a paradox?', icon: 'fa-infinity' },
      { text: 'What is a prime number?', icon: 'fa-hashtag' },
      { text: 'What is a palindrome?', icon: 'fa-arrows-alt-h' },
      { text: 'What is a Fibonacci sequence?', icon: 'fa-sort-numeric-up' },
      { text: 'What is a black hole?', icon: 'fa-rocket' },
      { text: 'What is a wormhole?', icon: 'fa-rocket' },
      { text: 'What is a quasar?', icon: 'fa-star' },
      { text: 'What is a galaxy?', icon: 'fa-globe' },
      { text: 'What is a planet?', icon: 'fa-globe' },
      { text: 'What is a star?', icon: 'fa-star' },
      { text: 'What is a comet?', icon: 'fa-rocket' },
      { text: 'What is an asteroid?', icon: 'fa-meteor' },
      { text: 'What is a meteor?', icon: 'fa-meteor' },
      { text: 'What is a meteorite?', icon: 'fa-meteor' },
      { text: 'What is a nebula?', icon: 'fa-cloud' },
      { text: 'What is a pulsar?', icon: 'fa-bolt' },
      { text: 'What is a magnetar?', icon: 'fa-magnet' },
      { text: 'What is a white dwarf?', icon: 'fa-star' },
      { text: 'What is a red giant?', icon: 'fa-star' },
      { text: 'What is a blue giant?', icon: 'fa-star' },
      { text: 'What is a brown dwarf?', icon: 'fa-star' },
      { text: 'What is a supergiant?', icon: 'fa-star' },
      { text: 'What is a hypergiant?', icon: 'fa-star' },
      { text: 'What is a neutron star?', icon: 'fa-star' },
      { text: 'What is a black dwarf?', icon: 'fa-star' },
      { text: 'What is a white hole?', icon: 'fa-star' },
      { text: 'What is a time crystal?', icon: 'fa-hourglass-half' },
      { text: 'What is a quantum computer?', icon: 'fa-microchip' },
      { text: 'What is a quantum dot?', icon: 'fa-dot-circle' },
      { text: 'What is a quantum bit?', icon: 'fa-microchip' },
      { text: 'What is a quantum gate?', icon: 'fa-door-open' },
      { text: 'What is a quantum circuit?', icon: 'fa-project-diagram' },
      { text: 'What is a quantum algorithm?', icon: 'fa-brain' },
      { text: 'What is a quantum protocol?', icon: 'fa-file-alt' },
      { text: 'What is a quantum network?', icon: 'fa-network-wired' },
      { text: 'What is a quantum internet?', icon: 'fa-globe' },
      { text: 'What is a quantum cloud?', icon: 'fa-cloud' },
      { text: 'What is a quantum blockchain?', icon: 'fa-link' },
      { text: 'What is a quantum meme?', icon: 'fa-grin-beam' },
      { text: 'What is a quantum joke?', icon: 'fa-laugh' },
      { text: 'What is a quantum paradox?', icon: 'fa-infinity' },
      { text: 'What is a quantum palindrome?', icon: 'fa-arrows-alt-h' },
      { text: 'What is a quantum Fibonacci sequence?', icon: 'fa-sort-numeric-up' },
    ];

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function displaySuggestions() {
      const suggestionsContainer = document.getElementById('suggestion-row');
      suggestionsContainer.innerHTML = '';
      const shuffled = shuffleArray([...allSuggestions]);
      const selectedSuggestions = shuffled.slice(0, 2);
      let suggestionsHTML = '';
      selectedSuggestions.forEach(suggestion => {
        suggestionsHTML += `
          <div class="suggestion-card" onclick="setPrompt('${suggestion.text.replace(/'/g, "\\'")}')">
            <span class="suggestion-text">${suggestion.text}</span>
            <span class="suggestion-icon"><i class="fas ${suggestion.icon}"></i></span>
          </div>
        `;
      });
      suggestionsContainer.innerHTML = suggestionsHTML;
      document.getElementById('suggestion-row-placeholder').style.display = selectedSuggestions.length ? '' : 'none';
    }

    function setPrompt(text) {
      document.getElementById('user-input').value = text;
      document.getElementById('user-input').focus();
    }
    
    function addMessage(content, type) {
      const messagesDiv = document.getElementById('chat-messages');
      const messageElement = document.createElement('div');
      messageElement.className = 'message ' + type + ' classic';
      messageElement.innerHTML = content;
      messagesDiv.appendChild(messageElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function showLoading() {
      const messagesDiv = document.getElementById('chat-messages');
      const loadingElement = document.createElement('div');
      loadingElement.id = 'loading-message';
      loadingElement.className = 'message bot';
      loadingElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Typing...';
      messagesDiv.appendChild(loadingElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // --- Dynamic Thinking Messages ---
    const thinkingMessages = [
      "NexusAI is synthesizing your answerâ€¦",
      "Exploring the web for knowledgeâ€¦",
      "Consulting trusted sourcesâ€¦",
      "Piecing together the factsâ€¦",
      "Scraping the web for the latest infoâ€¦",
      "Connecting the dotsâ€¦",
      "Gathering insights from around the worldâ€¦",
      "Crunching data and wisdomâ€¦",
      "Fact-checking across the universeâ€¦",
      "Analyzing, reasoning, respondingâ€¦",
      "Surfing the digital cosmosâ€¦",
      "Scanning articles and databasesâ€¦",
      "Synthesizing a smart responseâ€¦",
      "Looking for the best sourcesâ€¦",
      "Reading, learning, answeringâ€¦",
      "Unlocking the vaults of informationâ€¦",
      "Scouring expert opinionsâ€¦",
      "Checking the latest updatesâ€¦",
      "Merging facts and creativityâ€¦",
      "Your answer is being craftedâ€¦"
    ];

    function showThinking() {
      hideThinking();
      const messagesDiv = document.getElementById('chat-messages');
      const thinkingDiv = document.createElement('div');
      thinkingDiv.id = 'thinking-indicator';
      thinkingDiv.style.display = 'flex';
      thinkingDiv.style.justifyContent = 'center';
      thinkingDiv.style.alignItems = 'center';
      thinkingDiv.style.flexDirection = 'column';
      thinkingDiv.style.margin = '2em 0 1.5em 0';
      thinkingDiv.style.width = '100%';
      thinkingDiv.innerHTML = `
        <div class="ai-orb"></div>
        <div class="thinking-msg"></div>
      `;
      messagesDiv.appendChild(thinkingDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      // Start cycling messages
      thinkingMsgIndex = Math.floor(Math.random() * thinkingMessages.length);
      const msgDiv = thinkingDiv.querySelector('.thinking-msg');
      msgDiv.textContent = thinkingMessages[thinkingMsgIndex];
      thinkingInterval = setInterval(() => {
        thinkingMsgIndex = (thinkingMsgIndex + 1) % thinkingMessages.length;
        msgDiv.textContent = thinkingMessages[thinkingMsgIndex];
      }, 1500);
    }
    function hideThinking() {
      if (thinkingInterval) {
        clearInterval(thinkingInterval);
        thinkingInterval = null;
      }
      const old = document.getElementById('thinking-indicator');
      if (old) old.remove();
    }
    hideThinking();
    // --- End Dynamic Thinking Messages ---

    // --- Chat Form Submission ---
    async function sendMessage(event) {
      event.preventDefault();
      const input = document.getElementById('user-input');
      const text = input.value.trim();
      if (!text) return false;
      addMessage(text, 'user');
      input.value = '';
      showThinking();
      try {
        const response = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });
        const data = await response.json();
        hideThinking();
        addMessage(data.response, 'bot');
        firstPromptSent = true;
        document.getElementById('suggestion-row').style.display = 'none';
        document.getElementById('suggestion-row-placeholder').style.display = 'none';
      } catch (e) {
        hideThinking();
        addMessage('<span style="color:red">An error occurred. Please try again.</span>', 'bot');
      }
      return false;
    }

    // --- Clear Chat Functionality ---
    document.getElementById('clear-btn').addEventListener('click', function() {
      document.getElementById('chat-messages').innerHTML = '';
      firstPromptSent = false;
      displaySuggestions(); // Show new suggestions again
    });
    // --- End Clear Chat ---

    // --- Settings Modal Functionality ---
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModalBg = document.getElementById('settings-modal-bg');
    const closeSettingsBtn = document.getElementById('close-settings');
    const themeToggle = document.getElementById('theme-toggle');
    const fontSizeSelect = document.getElementById('font-size-select');
    const bubbleStyleRadios = document.getElementsByName('bubble-style');
    const aiPersonalityRadios = document.getElementsByName('ai-personality');
    const saveSettingsBtn = document.getElementById('save-settings');
    const uiStyleDropdown = document.getElementById('ui-style-dropdown');
    const uiStyleSelected = document.getElementById('ui-style-selected');
    const uiStyleSelectedLabel = document.getElementById('ui-style-selected-label');
    const uiStyleSelectedIcon = document.getElementById('ui-style-selected-icon');
    const uiStyleOptions = document.getElementById('ui-style-options');
    const uiStyleOptionDivs = uiStyleOptions.querySelectorAll('.ui-style-option');
    const uiStyleIcons = {
      'classic-ui': '<i class="fas fa-square"></i>',
      'modern-ui': '<i class="fas fa-gem"></i>'
    };

    // Load settings from localStorage
    function loadSettings() {
      const theme = localStorage.getItem('theme') || 'dark';
      const fontSize = localStorage.getItem('fontSize') || 'font-medium';
      const bubbleStyle = localStorage.getItem('bubbleStyle') || 'classic';
      const aiPersonality = localStorage.getItem('aiPersonality') || 'balanced';
      const uiStyle = localStorage.getItem('uiStyle') || 'classic-ui';
      // Theme
      if (theme === 'light') {
        document.body.classList.add('light-mode');
        themeToggle.checked = true;
      } else {
        document.body.classList.remove('light-mode');
        themeToggle.checked = false;
      }
      // UI Style
      document.body.classList.remove('classic-ui', 'modern-ui');
      document.body.classList.add(uiStyle);
      uiStyleOptionDivs.forEach(div => {
        div.classList.remove('selected');
        if (div.dataset.value === uiStyle) div.classList.add('selected');
      });
      uiStyleSelectedLabel.textContent = uiStyle === 'modern-ui' ? 'Modern' : 'Classic';
      uiStyleSelectedIcon.innerHTML = uiStyleIcons[uiStyle];
      // Font size
      document.body.classList.remove('font-small', 'font-medium', 'font-large');
      document.body.classList.add(fontSize);
      fontSizeSelect.value = fontSize;
      // Bubble style
      for (const radio of bubbleStyleRadios) {
        radio.checked = (radio.value === bubbleStyle);
      }
      // AI Personality
      for (const radio of aiPersonalityRadios) {
        radio.checked = (radio.value === aiPersonality);
      }
      // Apply bubble style to chat
      updateBubbleStyle();
    }

    function updateBubbleStyle() {
      const bubbleStyle = document.querySelector('input[name="bubble-style"]:checked').value;
      document.querySelectorAll('.message').forEach(msg => {
        msg.classList.remove('classic', 'minimal');
        msg.classList.add(bubbleStyle);
      });
    }

    // Save settings to localStorage
    saveSettingsBtn.addEventListener('click', () => {
      // Theme
      localStorage.setItem('theme', themeToggle.checked ? 'light' : 'dark');
      // Font size
      localStorage.setItem('fontSize', fontSizeSelect.value);
      // Bubble style
      const bubbleStyle = document.querySelector('input[name="bubble-style"]:checked').value;
      localStorage.setItem('bubbleStyle', bubbleStyle);
      // AI Personality
      const aiPersonality = document.querySelector('input[name="ai-personality"]:checked').value;
      localStorage.setItem('aiPersonality', aiPersonality);
      // UI Style
      const selectedDiv = uiStyleOptions.querySelector('.ui-style-option.selected');
      if (selectedDiv) localStorage.setItem('uiStyle', selectedDiv.dataset.value);
      // Apply changes
      loadSettings();
      settingsModalBg.classList.remove('active');
    });

    // Apply bubble style to new messages
    const origAddMessage = addMessage;
    addMessage = function(content, type) {
      origAddMessage(content, type);
      updateBubbleStyle();
    };

    settingsBtn.addEventListener('click', () => {
      settingsModalBg.classList.add('active');
      themeToggle.checked = document.body.classList.contains('light-mode');
      fontSizeSelect.value = document.body.classList.contains('font-small') ? 'font-small' : document.body.classList.contains('font-large') ? 'font-large' : 'font-medium';
      // Bubble style
      const bubbleStyle = localStorage.getItem('bubbleStyle') || 'classic';
      for (const radio of bubbleStyleRadios) {
        radio.checked = (radio.value === bubbleStyle);
      }
      // AI Personality
      const aiPersonality = localStorage.getItem('aiPersonality') || 'balanced';
      for (const radio of aiPersonalityRadios) {
        radio.checked = (radio.value === aiPersonality);
      }
    });
    closeSettingsBtn.addEventListener('click', () => {
      settingsModalBg.classList.remove('active');
    });
    settingsModalBg.addEventListener('click', (e) => {
      if (e.target === settingsModalBg) settingsModalBg.classList.remove('active');
    });
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.body.classList.add('light-mode');
      } else {
        document.body.classList.remove('light-mode');
      }
    });
    fontSizeSelect.addEventListener('change', function() {
      document.body.classList.remove('font-small', 'font-medium', 'font-large');
      document.body.classList.add(this.value);
    });
    for (const radio of bubbleStyleRadios) {
      radio.addEventListener('change', updateBubbleStyle);
    }
    uiStyleSelected.onclick = function(e) {
      e.stopPropagation();
      uiStyleDropdown.classList.toggle('open');
    };
    uiStyleOptionDivs.forEach(div => {
      div.onclick = function(e) {
        uiStyleOptionDivs.forEach(d => d.classList.remove('selected'));
        this.classList.add('selected');
        const value = this.dataset.value;
        uiStyleSelectedLabel.textContent = value === 'modern-ui' ? 'Modern' : 'Classic';
        uiStyleSelectedIcon.innerHTML = uiStyleIcons[value];
        document.body.classList.remove('classic-ui', 'modern-ui');
        document.body.classList.add(value);
        localStorage.setItem('uiStyle', value);
        uiStyleDropdown.classList.remove('open');
      };
    });
    document.addEventListener('click', function(e) {
      if (!uiStyleDropdown.contains(e.target)) {
        uiStyleDropdown.classList.remove('open');
      }
    });
    // On load
    loadSettings();
    displaySuggestions();

    // --- End Settings Modal ---

    // --- Disclaimer Toast Logic ---
    function showDisclaimerToast(autoHide = true) {
      const toast = document.getElementById('disclaimer-toast');
      toast.style.display = 'flex';
      if (autoHide) {
        clearTimeout(window._disclaimerTimeout);
        window._disclaimerTimeout = setTimeout(() => {
          toast.style.display = 'none';
          document.getElementById('show-disclaimer-btn').style.display = '';
        }, 8000);
      }
    }
    function hideDisclaimerToast() {
      document.getElementById('disclaimer-toast').style.display = 'none';
      document.getElementById('show-disclaimer-btn').style.display = '';
    }
    document.getElementById('close-disclaimer-btn').onclick = hideDisclaimerToast;
    document.getElementById('show-disclaimer-btn').onclick = function() {
      showDisclaimerToast(false);
      this.style.display = 'none';
    };
    // Show on load, then auto-hide
    showDisclaimerToast(true);
    // --- End Disclaimer Toast Logic ---

    // --- Animated Particles ---
    function createParticles() {
      const container = document.getElementById('nexus-particles');
      for (let i = 0; i < 18; i++) {
        const p = document.createElement('div');
        p.className = 'nexus-particle';
        const size = Math.random() * 32 + 18;
        p.style.width = p.style.height = size + 'px';
        p.style.left = (Math.random() * 100) + 'vw';
        p.style.top = (Math.random() * 80 + 10) + 'vh';
        p.style.animationDelay = (Math.random() * 10) + 's';
        container.appendChild(p);
      }
    }
    createParticles();
    // --- End Animated Particles ---

    // On first load, default to classic UI if not set
    if (!localStorage.getItem('uiStyle')) {
      localStorage.setItem('uiStyle', 'classic-ui');
    }
    loadSettings();

    // --- How It Works Modal Logic ---
    const howitworksBtn = document.getElementById('howitworks-btn');
    const howitworksModalBg = document.getElementById('howitworks-modal-bg');
    const closeHowitworksBtn = document.getElementById('close-howitworks');
    howitworksBtn.addEventListener('click', () => {
      howitworksModalBg.classList.add('active');
    });
    closeHowitworksBtn.addEventListener('click', () => {
      howitworksModalBg.classList.remove('active');
    });
    howitworksModalBg.addEventListener('click', (e) => {
      if (e.target === howitworksModalBg) howitworksModalBg.classList.remove('active');
    });
    // --- End How It Works Modal Logic ---

    // --- Documentation Modal Logic ---
    const documentationBtn = document.getElementById('howitworks-btn');
    const documentationModalBg = document.getElementById('documentation-modal-bg');
    const closeDocumentationBtn = document.getElementById('close-documentation');
    documentationBtn.addEventListener('click', () => {
      documentationModalBg.classList.add('active');
    });
    closeDocumentationBtn.addEventListener('click', () => {
      documentationModalBg.classList.remove('active');
    });
    documentationModalBg.addEventListener('click', (e) => {
      if (e.target === documentationModalBg) documentationModalBg.classList.remove('active');
    });
    // --- End Documentation Modal Logic ---
  </script>
</body>
</html> 